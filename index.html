<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#111111" />
  <title>Filament Trends & Ops Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">FT</div>
      <div>
        <div class="title">Filament Tracker</div>
        <div class="subtitle">Local-first PWA (Phase 1)</div>
      </div>
    </div>
    <button id="installBtn" class="btn subtle" hidden>Install</button>
  </header>

  <nav class="tabs" role="tablist" aria-label="Sections">
    <button class="tab active" data-view="catalog">Catalog</button>
    <button class="tab" data-view="trends">Trends</button>
    <button class="tab" data-view="ops">My Filament</button>
    <button class="tab" data-view="printlog">Print Log</button>
    <button class="tab" data-view="insights">Insights</button>
    <button class="tab" data-view="backup">Backup</button>
  </nav>

  <main class="container">
    <!-- CATALOG -->
    <section id="view-catalog" class="view">
      <div class="row">
        <h2>Catalog</h2>
        <div class="grow"></div>
        <button class="btn" id="seedBtn">Seed materials & colors</button>
        <button class="btn" id="addSkuBtn">Add SKU</button>
      </div>

      <details class="help">
        <summary>Help / How to use this tab</summary>
        <div class="muted small">
          <strong>What this tab does:</strong> Your master list of filament SKUs (Brand/Line/Material/Color/Finish/Additives).
          Create SKUs once, then use them everywhere else. Tap <em>Watch</em> on SKUs you want to track for price trends and deal radar.
          Use search + filters to find items fast.
        </div>
      </details>

      <div class="card">
        <div class="row gap">
          <input id="skuSearch" class="input grow" placeholder="Search (brand, line, material, color, finish, additives)" />
          <select id="materialFilter" class="input"></select>
          <select id="brandFilter" class="input"></select>
        </div>
      </div>

      <div id="skuList" class="list"></div>
    </section>

    <!-- TRENDS -->
    <section id="view-trends" class="view hidden">
      <div class="row">
        <h2>Trends</h2>
        <div class="grow"></div>
      </div>

      <details class="help">
        <summary>Help / How to use this tab</summary>
        <div class="muted small">
          <strong>What this tab does:</strong> Track historical pricing for a SKU. Select a watched SKU, then add
          <em>Price Snapshots</em> (base price, shipping, coupon/discount). The app calculates <strong>$/kg</strong> and keeps a history so you can
          see if a material/color is trending up or down and spot good deals.
          <div style="margin-top:8px;">
            <strong>Tip:</strong> Add snapshots whenever you see a sale. Later phases can automate snapshot pulls from vendor sites.
          </div>
        </div>
      </details>

      <div class="card">
        <div class="row gap">
          <select id="trendSkuSelect" class="input grow"></select>
          <button class="btn" id="addSnapshotBtn">Add Price Snapshot</button>
        </div>
        <div class="muted small">Charts come in Phase 1.1 — for now you’ll see snapshots + computed $/kg + simple change stats.</div>
      </div>

      <div id="snapshotList" class="list"></div>
    </section>

    <!-- OPS -->
    <section id="view-ops" class="view hidden">
      <div class="row">
        <h2>My Filament</h2>
        <div class="grow"></div>
        <button class="btn" id="addPurchaseBtn">Add Purchase</button>
        <button class="btn" id="addSpoolBtn">Add Spool</button>
      </div>

      <details class="help">
        <summary>Help / How to use this tab</summary>
        <div class="muted small">
          <strong>What this tab does:</strong> Your operational inventory view.
          <ul style="margin:8px 0 0 18px;">
            <li><strong>Watchlist</strong> = SKUs you actively track (price trends + deal radar).</li>
            <li><strong>Spools</strong> = physical rolls you own (used for depletion tracking).</li>
            <li><strong>Purchases</strong> = where/when you bought items (tax/shipping/notes).</li>
          </ul>
          <div style="margin-top:8px;">
            When you log print jobs, spool weight will decrement so you can see consumption patterns.
          </div>
        </div>
      </details>

      <div class="grid2">
        <div class="card">
          <h3>Watchlist</h3>
          <div id="watchList" class="list"></div>
        </div>
        <div class="card">
          <h3>Spools</h3>
          <div id="spoolList" class="list"></div>
        </div>
      </div>

      <div class="card">
        <h3>Purchases</h3>
        <div id="purchaseList" class="list"></div>
      </div>
    </section>

    <!-- PRINT LOG -->
    <section id="view-printlog" class="view hidden">
      <div class="row">
        <h2>Print Log</h2>
        <div class="grow"></div>
        <button class="btn" id="addPrintJobBtn">Log Print Job</button>
      </div>

      <details class="help">
        <summary>Help / How to use this tab</summary>
        <div class="muted small">
          <strong>What this tab does:</strong> Capture real usage and waste. Log a print job with <em>grams used</em>, outcome (success/fail/partial),
          and optional <em>scrap grams</em>.
          <div style="margin-top:8px;">
            <strong>Best practice:</strong> choose a <em>Spool</em> when logging. The app will decrement remaining grams automatically.
            This powers Insights (usage + waste hotspots).
          </div>
        </div>
      </details>

      <div class="card">
        <div class="row gap">
          <div class="pill">Printer: <strong>Bambu P2S</strong></div>
          <div class="pill">AMS: <strong>AMS 2 Pro</strong></div>
          <div class="pill">Defaults: <strong>1.75mm</strong>, <strong>1000g</strong></div>
        </div>
      </div>

      <div id="printJobList" class="list"></div>
    </section>

    <!-- INSIGHTS -->
    <section id="view-insights" class="view hidden">
      <div class="row">
        <h2>Insights</h2>
        <div class="grow"></div>
      </div>

      <details class="help">
        <summary>Help / How to use this tab</summary>
        <div class="muted small">
          <strong>What this tab does:</strong> Turn your logs into decisions.
          <ul style="margin:8px 0 0 18px;">
            <li><strong>Usage (last 30 days):</strong> top SKUs by grams used (from Print Log).</li>
            <li><strong>Waste hotspots:</strong> highest scrap % (add scrap grams in Print Log).</li>
            <li><strong>Deal radar:</strong> watched SKUs ranked by latest <strong>$/kg</strong> (from Trends snapshots).</li>
          </ul>
        </div>
      </details>

      <div class="grid2">
        <div class="card">
          <h3>Usage (last 30 days)</h3>
          <div id="usage30" class="list"></div>
        </div>
        <div class="card">
          <h3>Waste Hotspots</h3>
          <div id="wasteHotspots" class="list"></div>
        </div>
      </div>

      <div class="card">
        <h3>Deal Radar (latest snapshots)</h3>
        <div id="dealRadar" class="list"></div>
      </div>
    </section>

    <!-- BACKUP (POLISHED) -->
    <section id="view-backup" class="view hidden">
      <div class="row">
        <h2>Backup</h2>
        <div class="grow"></div>
      </div>

      <details class="help">
        <summary>Help / How to use this tab</summary>
        <div class="muted small">
          <strong>What this tab does:</strong> Export JSON (full backup) and CSV (snapshots + jobs). Importing JSON replaces local data on this device.
          Use JSON to move between Android ↔ PC until cloud sync (Phase 2).
        </div>
      </details>

      <div class="card">
        <h3>Export</h3>
        <div class="row gap">
          <button class="btn" id="exportJsonBtn">Export JSON (full backup)</button>
          <button class="btn" id="exportCsvBtn">Export CSV (snapshots + jobs)</button>
        </div>
        <div class="muted small">Use JSON to move between Android ↔ PC until cloud sync (Phase 2).</div>
      </div>

      <div class="card">
        <h3>Import</h3>

        <div class="muted small" style="margin-bottom:10px;">
          Importing a JSON backup will <strong>replace</strong> your local data on this device.
          Use this to move data between Android ↔ PC.
        </div>

        <input type="file" id="importFile" class="input" accept=".json" hidden />

        <div class="row gap" style="align-items:center;">
          <button class="btn" id="pickJsonBtn" type="button">Choose JSON backup</button>
          <div class="pill" id="importFileName" style="max-width:55%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
            No file selected
          </div>
        </div>

        <div class="row gap" style="margin-top:12px;">
          <button class="btn" id="importConfirmBtn" type="button" disabled>Import & Replace</button>
          <button class="btn subtle" id="importCancelBtn" type="button" disabled>Clear</button>
        </div>

        <div class="muted small" style="margin-top:10px;">
          Tip: Export JSON on your other device, then import it here.
        </div>
      </div>

      <div class="card danger">
        <h3>Reset</h3>

        <div class="muted small" style="margin-bottom:10px;">
          This wipes the local database on <strong>this device only</strong>. It won’t affect other devices.
        </div>

        <div class="row gap" style="align-items:center;">
          <input id="wipeConfirmInput" class="input grow" placeholder='Type WIPE to enable' />
          <button class="btn danger" id="resetBtn" type="button" disabled>Wipe local database</button>
        </div>

        <div class="muted small" style="margin-top:10px;">
          Safety: the button stays disabled until you type <strong>WIPE</strong>.
        </div>
      </div>
    </section>
  </main>

  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="Dialog">
    <div class="modal-card">
      <div class="row">
        <h3 id="modalTitle">Modal</h3>
        <div class="grow"></div>
        <button class="btn subtle" id="modalClose">Close</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
